<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuis Interaktif - Sektor Perbankan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .question-nav-item {
            transition: all 0.2s ease-in-out;
            position: relative;
        }
        .question-nav-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .option-item {
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }
        .option-item:hover {
            background-color: #f0f4ff;
        }
        .explanation-card {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out, padding 0.5s ease-out;
        }
        .explanation-card.show {
            max-height: 500px;
            padding-top: 1rem;
            padding-bottom: 1rem;
        }
        .flag-indicator {
            position: absolute;
            top: -2px;
            right: 2px;
            font-size: 10px;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-800">Kuis Interaktif</h1>
            <p class="text-slate-600 mt-2">Uji Pengetahuan Anda di Sektor Perbankan</p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg h-fit sticky top-8">
                <h2 class="text-xl font-bold mb-4">Navigasi Soal</h2>
                
                <div class="mb-4">
                    <label for="category-filter" class="block text-sm font-medium text-gray-700 mb-2">Filter Kategori:</label>
                    <select id="category-filter" class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5">
                        <option value="all">Semua Kategori</option>
                    </select>
                </div>
                <div class="mb-4">
    <label for="search-input" class="block text-sm font-medium text-gray-700 mb-2">Cari Soal:</label>
    <input type="text" id="search-input" placeholder="Ketik kata kunci soal..." class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5">
</div>

                <div id="question-navigation" class="max-h-[500px] overflow-y-auto pr-2">
                </div>

                <button id="show-results-btn" class="w-full mt-6 bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 transition duration-300">
                    Lihat Hasil Akhir
                </button>
                <button id="reset-progress-btn" class="w-full mt-3 bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-300 transition duration-300 text-sm">
                    Reset Progres
                </button>
            </div>

            <div id="quiz-container" class="lg:col-span-2 bg-white p-6 md:p-8 rounded-xl shadow-lg">
                <div id="welcome-screen" class="text-center">
                    <h2 class="text-2xl font-bold text-slate-800 mb-4">Selamat Datang!</h2>
                    <p class="text-slate-600 mb-6">Progres Anda akan tersimpan otomatis di browser ini. Silakan pilih nomor soal untuk memulai atau melanjutkan kuis.</p>
                    <p class="text-sm text-slate-500">Hasil jawaban (benar/salah) akan langsung terlihat setelah Anda menjawab.</p>
                </div>

                <div id="question-display" class="hidden">
                    <div class="flex justify-between items-center mb-4">
                        <p id="question-category" class="bg-blue-100 text-blue-800 text-sm font-medium mr-2 px-2.5 py-0.5 rounded"></p>
                        <div class="flex items-center gap-3">
                            <button id="flag-question-btn" class="p-2 rounded-full hover:bg-gray-200 transition-colors" title="Tandai soal ini (ragu-ragu)">
                                <svg id="flag-icon" class="w-5 h-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                  <path d="M3.5 2.75a.75.75 0 00-1.5 0v14.5a.75.75 0 001.5 0v-1.512c.353.08.718.124 1.09.124h10.435c.42 0 .828-.05 1.22-.149A.75.75 0 0016 16.25V3.75a.75.75 0 00-.78-1.01l-1.22-.149H4.59c-.372 0-.737.044-1.09.124V2.75z" />
                                </svg>
                            </button>
                            <p class="text-lg font-semibold text-slate-700">Soal #<span id="question-number"></span></p>
                        </div>
                    </div>
                    <p id="question-text" class="text-lg text-gray-800 leading-relaxed mb-6"></p>
                    
                    <div id="options-container" class="space-y-3">
                    </div>

                    <div id="explanation-container">
                        <div id="explanation-card" class="explanation-card mt-6 bg-green-50 border-l-4 border-green-500 p-4 rounded-r-lg">
                            <h4 class="font-bold text-green-800">Pembahasan:</h4>
                            <p id="explanation-text" class="text-green-700 mt-2"></p>
                        </div>
                    </div>

                    <div class="mt-8 flex justify-between items-center">
                         <button id="prev-question-btn" class="bg-gray-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-600 transition duration-300 hidden">
                            &larr; Soal Sebelumnya
                        </button>
                        <button id="next-question-btn" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition duration-300 hidden">
                            Soal Berikutnya &rarr;
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="results-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex justify-center items-center">
        <div class="bg-white rounded-lg shadow-xl p-8 m-4 max-w-2xl w-full">
            <h2 class="text-2xl font-bold mb-4 text-center">Hasil Kuis Anda</h2>
            <div class="flex justify-around text-center mb-6">
                <div>
                    <p class="text-lg font-semibold">Skor Akhir</p>
                    <p id="final-score" class="text-4xl font-bold text-blue-600">0%</p>
                </div>
                <div>
                    <p class="text-lg font-semibold">Jawaban Benar</p>
                    <p id="correct-answers" class="text-4xl font-bold text-green-600">0</p>
                </div>
                 <div>
                    <p class="text-lg font-semibold">Jawaban Salah</p>
                    <p id="incorrect-answers" class="text-4xl font-bold text-red-600">0</p>
                </div>
            </div>
            <h3 class="text-xl font-bold mb-3 text-center">Analisis Berdasarkan Kategori</h3>
            <div id="category-results" class="space-y-3">
            </div>
            <div class="mt-6 text-center">
                 <button id="close-modal-btn" class="bg-gray-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-600 transition duration-300">
                    Tutup
                </button>
            </div>
        </div>
    </div>

    <script src="database.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            
            // Variabel Global
            let userAnswers = {};
            let flaggedQuestions = [];
            let currentQuestionId = null;
            const questionNavigation = document.getElementById('question-navigation');
            const questionDisplay = document.getElementById('question-display');
            const welcomeScreen = document.getElementById('welcome-screen');
            const categoryFilter = document.getElementById('category-filter');
            const resultsModal = document.getElementById('results-modal');
            const showResultsBtn = document.getElementById('show-results-btn');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const resetProgressBtn = document.getElementById('reset-progress-btn');
            const searchInput = document.getElementById('search-input');

            function saveProgress() {
                localStorage.setItem('quizUserAnswers', JSON.stringify(userAnswers));
                localStorage.setItem('quizFlaggedQuestions', JSON.stringify(flaggedQuestions));
            }

            function loadProgress() {
                const savedAnswers = localStorage.getItem('quizUserAnswers');
                if (savedAnswers) {
                    userAnswers = JSON.parse(savedAnswers);
                }
                const savedFlags = localStorage.getItem('quizFlaggedQuestions');
                if (savedFlags) {
                    flaggedQuestions = JSON.parse(savedFlags);
                }
            }
            
            function resetProgress() {
                if (confirm("Apakah Anda yakin ingin mereset semua progres dan tanda? Progres yang tersimpan akan dihapus secara permanen.")) {
                    localStorage.removeItem('quizUserAnswers');
                    localStorage.removeItem('quizFlaggedQuestions');
                    location.reload();
                }
            }

            function initializeQuiz() {
                loadProgress(); 

                const categories = [...new Set(questions.map(q => q.category))];
                categories.sort().forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    categoryFilter.appendChild(option);
                });
                
                renderNavigation();
                categoryFilter.addEventListener('change', renderNavigation);
                searchInput.addEventListener('input', renderNavigation);
                showResultsBtn.addEventListener('click', showResults);
                closeModalBtn.addEventListener('click', () => resultsModal.classList.add('hidden'));
                resetProgressBtn.addEventListener('click', resetProgress);
            }

            function toggleFlag(id) {
                const index = flaggedQuestions.indexOf(id);
                if (index > -1) {
                    flaggedQuestions.splice(index, 1);
                } else {
                    flaggedQuestions.push(id);
                }
                saveProgress();
                displayQuestion(id);
            }

            
function renderNavigation() {
    questionNavigation.innerHTML = '';
    const selectedCategory = categoryFilter.value;
    const searchQuery = searchInput.value.trim().toLowerCase();

    // Jika ada query pencarian (lebih dari 2 huruf), tampilkan hasil search
    if (searchQuery.length > 2) {
        renderSearchResults(searchQuery);
    } 
    // Jika tidak, tampilkan navigasi grid seperti biasa
    else {
        const filteredQuestions = questions.filter(q => selectedCategory === 'all' || q.category === selectedCategory);
        const totalQuestionsInQuiz = Math.max(...questions.map(q => q.id));

        for (let groupStart = 1; groupStart <= totalQuestionsInQuiz; groupStart += 100) {
            const versionNumber = questions.find(q => q.id >= groupStart)?.version;
            if (!versionNumber) continue;

            // Cek apakah ada soal di versi ini setelah difilter
            const questionsInVersion = filteredQuestions.filter(q => q.version === versionNumber);
            if (questionsInVersion.length === 0 && selectedCategory !== 'all') continue;
            
            // --- Membuat Label Versi Dinamis ---
            const separator = document.createElement('div');
            separator.className = 'w-full my-4 py-2 text-center bg-slate-200 text-slate-800 font-bold rounded-lg text-sm';
            separator.textContent = `SOAL VERSI ${versionNumber}`;
            questionNavigation.appendChild(separator);

            for (let subGroupStart = groupStart; subGroupStart < groupStart + 100; subGroupStart += 25) {
                const subGroupEnd = Math.min(subGroupStart + 24, groupStart + 99);
                
                const questionsInGroupForFilter = filteredQuestions.filter(q => q.id >= subGroupStart && q.id <= subGroupEnd);
                if (questionsInGroupForFilter.length === 0 && selectedCategory !== 'all') continue;

                const groupContainer = document.createElement('div');
                const header = document.createElement('h4');
                header.textContent = `Soal ${subGroupStart} - ${subGroupEnd}`;
                header.className = 'text-sm font-semibold text-gray-600 mt-4 pb-1 border-b';
                if (subGroupStart === groupStart) header.classList.remove('mt-4');
                groupContainer.appendChild(header);

                const gridContainer = document.createElement('div');
                gridContainer.className = 'grid grid-cols-5 sm:grid-cols-6 md:grid-cols-7 lg:grid-cols-5 gap-2 pt-2';

                for (let i = subGroupStart; i <= subGroupEnd; i++) {
                    const questionData = questions.find(q => q.id === i);
                    if (!questionData) continue;
                    
                    if (selectedCategory === 'all' || questionsInGroupForFilter.some(q => q.id === i)) {
                        const navItem = document.createElement('div');
                        navItem.textContent = i;
                        navItem.className = 'w-10 h-10 flex items-center justify-center font-bold rounded-md shadow-sm';
                        
                        navItem.classList.add('question-nav-item', 'cursor-pointer');
                        if (userAnswers[i]) {
                            navItem.classList.add(userAnswers[i].isCorrect ? 'bg-green-500' : 'bg-red-500', 'text-white');
                        } else {
                            navItem.classList.add('bg-gray-200', 'text-gray-700');
                        }
                        if (i === currentQuestionId) navItem.classList.add('ring-2', 'ring-blue-500', 'ring-offset-2');
                        
                        if (flaggedQuestions.includes(i)) {
                            const flagIcon = document.createElement('span');
                            flagIcon.textContent = 'ðŸš©';
                            flagIcon.className = 'flag-indicator';
                            navItem.appendChild(flagIcon);
                        }
                        navItem.addEventListener('click', () => displayQuestion(i));
                        gridContainer.appendChild(navItem);
                    }
                }
                groupContainer.appendChild(gridContainer);
                questionNavigation.appendChild(groupContainer);
            }
        }
    }
}


function renderSearchResults(query) {
    const results = questions.filter(q => q.question.toLowerCase().includes(query));
    
    if (results.length === 0) {
        questionNavigation.innerHTML = `<p class="text-gray-500 text-center p-4">Tidak ada soal yang cocok.</p>`;
        return;
    }

    results.forEach(result => {
        const resultItem = document.createElement('div');
        resultItem.className = 'p-3 border-b hover:bg-gray-100 cursor-pointer transition-colors';
        
        // Highlight kata kunci yang dicari
        const regex = new RegExp(query, 'gi');
        const highlightedText = result.question.replace(regex, `<mark class="bg-yellow-200 px-1 rounded">${query}</mark>`);

        resultItem.innerHTML = `
            <p class="font-bold text-sm text-blue-600">Soal #${result.id} (Versi ${result.version})</p>
            <p class="text-sm text-gray-700 mt-1">${highlightedText}</p>
        `;
        
        resultItem.addEventListener('click', () => {
            displayQuestion(result.id);
            // Optional: Hapus teks pencarian setelah diklik
            searchInput.value = '';
            renderNavigation(); // Kembali ke tampilan grid biasa
        });
        
        questionNavigation.appendChild(resultItem);
    });
}
            
            function handleOptionSelect(question, selectedOption) {
                if (userAnswers[question.id]) return;

                const isCorrect = selectedOption === question.answer;
                userAnswers[question.id] = { selected: selectedOption, isCorrect: isCorrect };
                
                saveProgress();

                showAnswer(question, selectedOption);
                renderNavigation();
            }

            function displayQuestion(id) {
                currentQuestionId = id;
                const question = questions.find(q => q.id === id);

                if (!question) return;

                welcomeScreen.classList.add('hidden');
                questionDisplay.classList.remove('hidden');

                document.getElementById('question-number').textContent = question.id;
                document.getElementById('question-category').textContent = question.category;
                document.getElementById('question-text').innerHTML = question.question;

                const flagBtn = document.getElementById('flag-question-btn');
                const flagIcon = document.getElementById('flag-icon');
                if (flaggedQuestions.includes(id)) {
                    flagIcon.classList.remove('text-gray-400');
                    flagIcon.classList.add('text-red-500');
                } else {
                    flagIcon.classList.add('text-gray-400');
                    flagIcon.classList.remove('text-red-500');
                }
                flagBtn.onclick = () => toggleFlag(id);


                const optionsContainer = document.getElementById('options-container');
                optionsContainer.innerHTML = '';

                const shuffledOptions = [...question.options].sort(() => Math.random() - 0.5);

                shuffledOptions.forEach(option => {
                    const optionWrapper = document.createElement('div');
                    optionWrapper.classList.add('option-item', 'border', 'border-gray-300', 'p-4', 'rounded-lg', 'text-gray-700');
                    optionWrapper.dataset.option = option;
                    optionWrapper.innerHTML = `<span>${option}</span>`;
                    if(userAnswers[id] && userAnswers[id].selected === option) {
                        optionWrapper.classList.add('bg-yellow-100', 'border-yellow-400');
                    }
                    optionWrapper.addEventListener('click', () => handleOptionSelect(question, option));
                    optionsContainer.appendChild(optionWrapper);
                });
                
                document.getElementById('explanation-container').innerHTML = `
                    <div id="explanation-card" class="explanation-card mt-6">
                        <h4 class="font-bold">Pembahasan:</h4>
                        <p id="explanation-text" class="mt-2"></p>
                    </div>
                `;
                
                const prevBtn = document.getElementById('prev-question-btn');
                const nextBtn = document.getElementById('next-question-btn');
                const currentIndex = questions.findIndex(q => q.id === currentQuestionId);

                if (currentIndex > 0) {
                    prevBtn.classList.remove('hidden');
                    prevBtn.onclick = () => displayQuestion(questions[currentIndex - 1].id);
                } else {
                    prevBtn.classList.add('hidden');
                }

                if (currentIndex < questions.length - 1) {
                    nextBtn.classList.remove('hidden');
                    nextBtn.onclick = () => displayQuestion(questions[currentIndex + 1].id);
                } else {
                     nextBtn.classList.add('hidden');
                }
                
                if (currentIndex > 0 && currentIndex < questions.length - 1) {
                    nextBtn.parentElement.classList.add('justify-between');
                    nextBtn.parentElement.classList.remove('justify-end', 'justify-start');
                } else if (currentIndex > 0) {
                    nextBtn.parentElement.classList.add('justify-start');
                    nextBtn.parentElement.classList.remove('justify-end', 'justify-between');
                } else {
                    nextBtn.parentElement.classList.add('justify-end');
                    nextBtn.parentElement.classList.remove('justify-start', 'justify-between');
                }


                if (userAnswers[id]) {
                    showAnswer(question, userAnswers[id].selected);
                }
                
                renderNavigation();
            }

            function showAnswer(question, selectedOption) {
                 const options = document.querySelectorAll('.option-item');
                 options.forEach(opt => {
                     opt.style.pointerEvents = 'none';
                     const optionText = opt.dataset.option;
                     
                     if (optionText === question.answer) {
                         opt.classList.remove('bg-yellow-100', 'border-yellow-400');
                         opt.classList.add('bg-green-100', 'border-green-500', 'font-bold');
                         opt.innerHTML += `<span class="ml-auto text-green-600">&#10003;</span>`;
                         opt.classList.add('flex', 'items-center');
                     } else if (optionText === selectedOption) {
                         opt.classList.remove('bg-yellow-100', 'border-yellow-400');
                         opt.classList.add('bg-red-100', 'border-red-500');
                         opt.innerHTML += `<span class="ml-auto text-red-600">&#10007;</span>`;
                         opt.classList.add('flex', 'items-center');
                     }
                 });

                 const explanationCard = document.getElementById('explanation-card');
                 const explanationText = document.getElementById('explanation-text');

                 explanationCard.className = 'explanation-card mt-6 bg-gray-50 border-l-4 p-4 rounded-r-lg';
                 if (userAnswers[question.id].isCorrect) {
                     explanationCard.classList.add('border-green-500', 'bg-green-50');
                     explanationText.innerHTML = question.explanation;
                     explanationText.classList.add('text-green-800');
                 } else {
                     explanationCard.classList.add('border-red-500', 'bg-red-50');
                     explanationText.innerHTML = question.explanation;
                     explanationText.classList.add('text-red-800');
                 }
                 setTimeout(() => explanationCard.classList.add('show'), 10);
            }
            
            function showResults() {
                const totalAnswered = Object.keys(userAnswers).length;
                if (totalAnswered === 0) {
                    alert("Anda belum menjawab satu soal pun.");
                    return;
                }

                const correctCount = Object.values(userAnswers).filter(ans => ans.isCorrect).length;
                const incorrectCount = totalAnswered - correctCount;
                const score = (correctCount / questions.length) * 100;

                document.getElementById('final-score').textContent = `${score.toFixed(0)}%`;
                document.getElementById('correct-answers').textContent = correctCount;
                document.getElementById('incorrect-answers').textContent = incorrectCount;
                
                const categoryResultsContainer = document.getElementById('category-results');
                categoryResultsContainer.innerHTML = '';
                const categories = [...new Set(questions.map(q => q.category))];
                
                categories.sort().forEach(category => {
                    const questionsInCategory = questions.filter(q => q.category === category);
                    const answeredInCategory = Object.keys(userAnswers).filter(id => {
                        const question = questions.find(q => q.id == id);
                        return question && question.category === category;
                    });
                    
                    if (answeredInCategory.length > 0) {
                        const correctInCategory = answeredInCategory.filter(id => userAnswers[id].isCorrect).length;
                        const categoryScore = (correctInCategory / answeredInCategory.length) * 100;
                        
                        const resultEl = document.createElement('div');
                        resultEl.innerHTML = `
                            <div class="flex justify-between items-center mb-1">
                                <span class="font-semibold text-gray-700">${category}</span>
                                <span class="text-sm text-gray-500">${correctInCategory}/${answeredInCategory.length} benar</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                <div class="h-2.5 rounded-full ${categoryScore >= 60 ? 'bg-green-500' : 'bg-red-500'}" style="width: ${categoryScore}%"></div>
                            </div>
                        `;
                        categoryResultsContainer.appendChild(resultEl);
                    }
                });

                resultsModal.classList.remove('hidden');
            }

            initializeQuiz();
        });
    </script>

</body>
</html>




